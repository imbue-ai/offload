# shotgun configuration for running sculptor unit tests on Modal

[shotgun]
max_parallel = 4
test_timeout_secs = 300
retry_count = 1
stream_output = true

[provider]
type = "remote"
create_command = "uv run --project /Users/jacobkirmayer/imbue/shotgun-rs /Users/jacobkirmayer/imbue/shotgun-rs/scripts/modal-create-sculptor.py"
exec_command = "uv run --project /Users/jacobkirmayer/imbue/shotgun-rs /Users/jacobkirmayer/imbue/shotgun-rs/scripts/modal-exec.py {sandbox_id} {command}"
destroy_command = "uv run --project /Users/jacobkirmayer/imbue/shotgun-rs /Users/jacobkirmayer/imbue/shotgun-rs/scripts/modal-destroy.py {sandbox_id}"
timeout_secs = 600

[discovery]
type = "generic"
# Discover tests locally using pytest --collect-only, strip "sculptor/" prefix for sandbox paths
discover_command = "uv run --project sculptor pytest --collect-only -q sculptor/sculptor 2>/dev/null | grep '::' | sed 's|^sculptor/||'"
# Run tests in the sandbox (source is baked into /app)
run_command = "cd /app && PYTHONPATH=/app pytest -v --tb=short {tests}"

[report]
output_dir = "test-results"
junit = false
