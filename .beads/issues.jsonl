{"id":"code-1","title":"Update Cargo.toml to Rust 2024 edition","description":"Change edition from 2021 to 2024 in Cargo.toml. This enables Rust 2024 edition defaults as required by STYLE_GUIDE.md.","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-27T00:03:24.575536013Z","created_by":"Danver Braganza","updated_at":"2026-01-27T00:08:37.563787672Z"}
{"id":"code-10","title":"Rename project: Update src/*.rs files from offload to offload","description":"Update all references in Rust source files from 'offload' to 'offload'. This includes:\n- src/main.rs: CLI name, default config file, use statements\n- src/lib.rs: crate docs and examples\n- src/config.rs: doc comments\n- src/config/schema.rs: struct names (OffloadConfig -\u003e OffloadConfig), doc comments\n- src/bundled.rs: cache directory paths\n- src/report.rs: doc examples\n- src/report/junit.rs: testsuite default name\n- src/provider.rs, src/provider/*.rs: doc examples\n- src/framework.rs, src/framework/*.rs: doc examples\n- src/orchestrator.rs, src/orchestrator/*.rs: doc examples and sandbox ID prefix\n- src/connector.rs: doc examples\n\nThe struct OffloadConfig should be renamed to OffloadConfig, and the field 'offload' in Config should be renamed to 'offload'.","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-29T18:24:57.591601347Z","created_by":"Danver Braganza","updated_at":"2026-01-29T18:42:11.144979343Z"}
{"id":"code-11","title":"Rename project: Rename offload-*.toml config files to offload-*.toml","description":"Rename all configuration files with 'offload' prefix to use 'offload' prefix:\n- offload.toml -\u003e offload.toml\n- offload-local.toml -\u003e offload-local.toml\n- offload-modal.toml -\u003e offload-modal.toml\n- offload-cargo-local.toml -\u003e offload-cargo-local.toml\n- offload-cargo-modal.toml -\u003e offload-cargo-modal.toml\n- offload-computronium-modal.toml -\u003e offload-computronium-modal.toml\n- offload-sculptor-modal.toml -\u003e offload-sculptor-modal.toml\n\nAlso update the [offload] section in these files to [offload].","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-29T18:25:03.560121502Z","created_by":"Danver Braganza","updated_at":"2026-01-29T18:45:18.15783543Z"}
{"id":"code-12","title":"Rename project: Update README.md from offload to offload","description":"Update README.md to replace all references to 'offload' with 'offload'. This includes:\n- Project title\n- Feature descriptions\n- Installation commands\n- CLI examples (offload init, offload run, etc.)\n- Configuration file references (offload.toml -\u003e offload.toml)\n- Example configuration sections ([offload] -\u003e [offload])\n- All documentation text","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-29T18:25:08.706866046Z","created_by":"Danver Braganza","updated_at":"2026-01-29T18:50:11.476117046Z"}
{"id":"code-13","title":"Rename project: Update scripts/modal_sandbox.py from offload to offload","description":"Update scripts/modal_sandbox.py to replace all references to 'offload' with 'offload'. This includes:\n- Module docstring\n- CLI help text\n- Modal App names (offload-sandbox -\u003e offload-sandbox, offload-rust-sandbox -\u003e offload-rust-sandbox, etc.)\n- Function docstrings\n- Comments","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-29T18:25:14.017333924Z","created_by":"Danver Braganza","updated_at":"2026-01-29T18:52:06.241321461Z"}
{"id":"code-14","title":"Rename project: Update .gitignore and .beads/issues.jsonl from offload to offload","description":"Update supporting files:\n- .gitignore: Change offload.local.toml to offload.local.toml\n- .beads/issues.jsonl: Update any references to 'offload' in issue descriptions to 'offload'","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-29T18:25:18.236357134Z","created_by":"Danver Braganza","updated_at":"2026-01-29T19:03:04.743285513Z"}
{"id":"code-15","title":"Update hardcoded paths in config files to use @modal_sandbox.py syntax","description":"Update offload-sculptor-modal.toml and offload-computronium-modal.toml to replace hardcoded paths like:\n  /Users/jacobkirmayer/imbue/shotgun-rs/scripts/modal_sandbox.py\nwith the portable syntax:\n  @modal_sandbox.py\n\nThis removes developer-specific paths and uses the project's script lookup feature.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-29T19:08:54.018824302Z","created_by":"Danver Braganza","updated_at":"2026-01-29T19:08:54.018824302Z"}
{"id":"code-16","title":"Add dockerfile_path field to DefaultProviderConfig","description":"Add an optional 'dockerfile_path' field (Option\u003cString\u003e) to DefaultProviderConfig. This field represents a relative path to a Dockerfile that can be used when creating Modal sandboxes from custom Docker images.\n\nInclude:\n- The new field with serde attributes\n- Doc comments explaining it's a relative path to a Dockerfile\n- Default value of None\n\nFiles to modify:\n- src/config/schema.rs (add field to DefaultProviderConfig)","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-29T19:54:17.354981257Z","created_by":"Danver Braganza","updated_at":"2026-01-29T20:37:07.288571836Z"}
{"id":"code-17","title":"Add --dockerfile option to modal_sandbox.py create commands","description":"Update modal_sandbox.py to support building images from Dockerfiles.\n\nAdd a --dockerfile option to the create commands (create default, create rust) that:\n1. Takes a relative path to a Dockerfile  \n2. Uses modal.Image.from_dockerfile() to build the image instead of the hardcoded image definition\n3. Falls back to existing behavior when --dockerfile is not provided\n\nThe Dockerfile path should be resolved relative to the current working directory.\n\nFiles to modify:\n- scripts/modal_sandbox.py (add --dockerfile option to create subcommands)","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-29T19:54:23.477729968Z","created_by":"Danver Braganza","updated_at":"2026-01-29T20:39:29.92591743Z"}
{"id":"code-18","title":"Update offload-modal.toml and offload-cargo-modal.toml to use Dockerfile","description":"Update the local example config files to use the new dockerfile_path feature.\n\nChanges needed:\n1. Add dockerfile_path = '.devcontainer/Dockerfile' to the [provider] section\n2. Update create_command to pass the --dockerfile flag with the path\n\nThese are the 'local examples' - configs designed to work with the offload repo itself.\n\nFiles to modify:\n- offload-modal.toml  \n- offload-cargo-modal.toml","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-29T19:54:30.062342929Z","created_by":"Danver Braganza","updated_at":"2026-01-29T20:43:18.762483175Z"}
{"id":"code-19","title":"Expand dockerfile_path placeholder in create_command","description":"The create_command is run without expanding the {dockerfile_path} placeholder, causing a FileNotFoundError when trying to use the dockerfile_path feature.\n\nIn src/provider/default.rs, the create_sandbox method runs self.config.create_command directly without substituting {dockerfile_path}.\n\nFix: Before running the create_command, replace {dockerfile_path} with the actual value from self.config.dockerfile_path (or empty string if None).\n\nLocation: src/provider/default.rs, create_sandbox method around line 147","status":"done","priority":0,"issue_type":"bug","created_at":"2026-01-29T23:07:39.196891168Z","created_by":"Danver Braganza","updated_at":"2026-01-29T23:10:46.755272839Z"}
{"id":"code-2","title":"Rename config/mod.rs to config.rs (2018+ module style)","description":"Rename src/config/mod.rs to src/config.rs following STYLE_GUIDE.md. The config directory contains schema.rs which should remain in src/config/. Update lib.rs module declaration accordingly.","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-27T00:03:33.391277628Z","created_by":"Danver Braganza","updated_at":"2026-01-27T00:10:46.641763218Z"}
{"id":"code-20","title":"Restructure modal_sandbox.py: separate dockerfile command from existing commands","description":"Currently --dockerfile is a flag on 'create default' and 'create rust'. This makes the build slow when dockerfile is used.\n\nRestructure so that:\n1. 'create dockerfile \u003cpath\u003e' - new command that builds from a Dockerfile. Must validate the file exists and print sensible error if not.\n2. 'create default', 'create rust', etc. - keep using their hardcoded modal.Image definitions (fast path)\n\nThis allows users to choose:\n- Fast: use the built-in image definitions (coupled but fast)\n- Flexible: use a Dockerfile (slow but decoupled)\n\nChanges needed:\n1. Remove --dockerfile option from create_default and create_rust\n2. Add new 'create dockerfile' subcommand that takes a path argument\n3. Update the TOML configs to use 'create dockerfile .devcontainer/Dockerfile' instead of 'create default --dockerfile {dockerfile_path}'","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-29T23:35:56.740078843Z","created_by":"Danver Braganza","updated_at":"2026-01-29T23:42:19.484075673Z"}
{"id":"code-21","title":"Bump ratchet no-bare-print budget for scripts","description":"The new create dockerfile command in modal_sandbox.py adds 2 print statements:\n1. Error message to stderr when dockerfile not found\n2. sandbox.object_id output (standard pattern for create commands)\n\nThese are legitimate uses in a CLI script. Bump the ratchet budget from 25 to 27.\n\nFile to modify: ratchet-counts.toml","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-29T23:40:04.172825263Z","created_by":"Danver Braganza","updated_at":"2026-01-29T23:42:19.493969048Z"}
{"id":"code-22","title":"Add image cache infrastructure to modal_sandbox.py","description":"Add infrastructure for caching Modal image IDs:\n\n1. Add CACHE_DIR constant (~/.cache/offload/)\n2. Add ImageCacheEntry dataclass with fields: image_id, dockerfile_hash, mtime, created_at\n3. Add functions: get_cache_path(), load_cache(), save_cache(), compute_dockerfile_hash()\n4. Cache is stored as JSON in ~/.cache/offload/modal-images.json\n\nFiles to modify: scripts/modal_sandbox.py only","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-30T17:03:41.744724138Z","created_by":"Danver Braganza","updated_at":"2026-01-30T17:15:18.949896169Z","dependencies":[{"issue_id":"code-22","depends_on_id":"code-26","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-23","title":"Add build-image subcommand to modal_sandbox.py","description":"Add a new 'build-image' subcommand group that eagerly builds Modal images and caches their IDs:\n\n1. Add @cli.group() for 'build-image' subcommand\n2. Add build-image subcommands for each sandbox type (default, rust, dockerfile, computronium, sculptor, mngr)\n3. Each subcommand:\n   - Builds the image using image.build(app)\n   - Extracts image.object_id\n   - Computes dockerfile hash (if applicable)\n   - Saves to cache via save_cache()\n   - Prints the image_id to stdout\n\nFiles to modify: scripts/modal_sandbox.py only\n\nDepends on: code-22","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-30T17:03:51.313432628Z","created_by":"Danver Braganza","updated_at":"2026-01-30T17:19:58.91417584Z","dependencies":[{"issue_id":"code-23","depends_on_id":"code-22","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-24","title":"Modify create subcommands to use cached images","description":"Update each create subcommand to check for and use cached image IDs:\n\n1. At the start of each create subcommand (default, rust, dockerfile, computronium, sculptor, mngr):\n   - Load cache and check for valid cached image for this sandbox type\n   - If cached and valid (hash matches, not expired), use modal.Image.from_id(cached_image_id)\n   - If not cached or invalid, fall back to current behavior (build image inline)\n   - Optionally update cache after successful sandbox creation\n\n2. Add --force-rebuild flag to skip cache lookup\n\n3. Print cache status to stderr (e.g., 'Using cached image im-xxx' or 'Building fresh image...')\n\nFiles to modify: scripts/modal_sandbox.py only\n\nDepends on: code-22, code-23","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-30T17:03:59.448569882Z","created_by":"Danver Braganza","updated_at":"2026-01-30T17:30:40.847743596Z","dependencies":[{"issue_id":"code-24","depends_on_id":"code-22","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"code-24","depends_on_id":"code-23","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-25","title":"Add cache-status and cache-clear subcommands","description":"Add utility subcommands for cache management:\n\n1. Add 'cache-status' subcommand:\n   - Shows all cached images with their IDs, sandbox types, creation dates\n   - Shows cache file location\n   - Indicates if images are valid/stale\n\n2. Add 'cache-clear' subcommand:\n   - Clears all cached image entries\n   - Add optional --type flag to clear only specific sandbox type\n\nFiles to modify: scripts/modal_sandbox.py only\n\nDepends on: code-22","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-30T17:04:06.06834801Z","created_by":"Danver Braganza","updated_at":"2026-01-30T17:33:13.234379972Z","dependencies":[{"issue_id":"code-25","depends_on_id":"code-22","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"code-26","title":"Bump ratchet budget for no-dataclasses-import in scripts","description":"Bump the ratchet budget for no-dataclasses-import rule to allow dataclasses usage in scripts/modal_sandbox.py.\n\nAdd the following to ratchet-counts.toml:\n[no-dataclasses-import]\n\"scripts\" = 1\n\nThis is required for the image cache infrastructure (code-22) which uses @dataclass for ImageCacheEntry.\n\nFiles to modify: ratchet-counts.toml only","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-30T17:11:22.842352712Z","created_by":"Danver Braganza","updated_at":"2026-01-30T17:14:06.181033635Z"}
{"id":"code-27","title":"Change cache location from ~/.cache/offload to .offload/","description":"Update modal_sandbox.py to store the image cache in the current working directory instead of the user's home directory.\n\nChanges required:\n1. Change CACHE_DIR from Path.home() / '.cache' / 'offload' to Path.cwd() / '.offload'\n2. Change CACHE_FILE from 'modal-images.json' to 'modal_images.json' (underscore for consistency)\n3. Update any references to these constants\n\nThis makes the cache:\n- Per-project instead of global\n- Portable with the project\n- Cross-platform compatible (no home directory issues)\n\nFiles to modify: scripts/modal_sandbox.py only","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-30T17:46:36.094422093Z","created_by":"Danver Braganza","updated_at":"2026-01-30T17:49:25.62786088Z"}
{"id":"code-28","title":"Add logging to distinguish image builds from sandbox creation","description":"Add tracing logs in the Rust code to provide visibility into when Modal images are being built vs when sandboxes are being created.\n\nThe create_command output goes through the DefaultProvider in src/provider/default.rs. We should:\n1. Log when create_command is invoked\n2. Parse stderr from the create_command to detect image building vs cached image usage\n3. Log appropriately (e.g., 'Building image...' vs 'Using cached image' vs 'Creating sandbox...')\n\nThe modal_sandbox.py script prints status messages to stderr:\n- 'Building image...' or 'Building image from Dockerfile...' when building\n- 'Using cached image' when using cache\n- 'Creating sandbox...' or 'Sandbox ready: \u003cid\u003e' when creating sandbox\n\nFiles to modify: src/provider/default.rs","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-30T17:53:05.389638218Z","created_by":"Danver Braganza","updated_at":"2026-01-30T17:55:49.673457544Z"}
{"id":"code-29","title":"Create ModalProvider struct in src/provider/modal.rs","description":"Create a new ModalProvider struct that handles: 1. Loading cached image IDs from .offload/modal_images.json using the cache module 2. Computing Dockerfile hash and checking cache validity 3. Delegating to Python for image building when cache miss 4. Storing new image IDs in cache 5. Creating sandboxes using cached image IDs. The provider should call modal_sandbox.py with appropriate commands for Modal operations only.\n\nCRITICAL: Do NOT use unwrap() anywhere in production code. Use proper error handling with Result types and context. The ratchet budget for no-unwrap in src/provider is 2, and we cannot exceed it.","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-30T18:50:14.28591418Z","created_by":"Danver Braganza","updated_at":"2026-01-30T18:56:10.620709553Z"}
{"id":"code-3","title":"Rename discovery/mod.rs to discovery.rs (2018+ module style)","description":"Rename src/discovery/mod.rs to src/discovery.rs following STYLE_GUIDE.md. The discovery directory contains cargo.rs, generic.rs, pytest.rs which should remain in src/discovery/. Update lib.rs module declaration accordingly.","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-27T00:03:34.165780754Z","created_by":"Danver Braganza","updated_at":"2026-01-27T00:13:00.993596085Z"}
{"id":"code-30","title":"Wire Modal provider into main.rs","description":"Update main.rs to instantiate ModalProvider when config type is 'modal'.\n\nRequirements:\n1. Import ModalProvider from provider::modal\n2. Update the provider instantiation match arm to create ModalProvider for Modal config\n3. Handle errors properly (ModalProvider::from_config returns ProviderResult)\n4. Update the run_with_provider function to accept ModalProvider\n\nFiles to modify: src/main.rs","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-30T18:56:23.02452792Z","created_by":"Danver Braganza","updated_at":"2026-01-30T19:01:01.089570549Z"}
{"id":"code-31","title":"Update offload-modal.toml for new Modal provider type","description":"Update offload-modal.toml to use the new Modal provider type instead of default provider with Modal commands.\n\nChange from:\n[provider]\ntype = \"default\"\ndockerfile_path = \".devcontainer/Dockerfile\"\ncreate_command = \"uv run @modal_sandbox.py create dockerfile {dockerfile_path}\"\nexec_command = \"uv run @modal_sandbox.py exec {sandbox_id} {command}\"\ndestroy_command = \"uv run @modal_sandbox.py destroy {sandbox_id}\"\n\nTo:\n[provider]\ntype = \"modal\"\napp_name = \"offload-sandbox\"\nimage_type = { dockerfile = \".devcontainer/Dockerfile\" }\ntimeout_secs = 600\n\nFiles to modify: offload-modal.toml","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-30T19:01:14.56022568Z","created_by":"Danver Braganza","updated_at":"2026-01-30T19:02:27.339546755Z"}
{"id":"code-32","title":"Clean up DefaultProviderConfig: remove dockerfile_path","description":"Remove dockerfile_path field from DefaultProviderConfig since it is now Modal-specific.\n\nRequirements:\n1. Remove dockerfile_path field from DefaultProviderConfig in src/config/schema.rs\n2. Remove the placeholder replacement for {dockerfile_path} in src/provider/default.rs\n3. Update any documentation that mentions dockerfile_path in default provider context\n\nFiles to modify:\n- src/config/schema.rs\n- src/provider/default.rs","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-30T19:02:37.581457093Z","created_by":"Danver Braganza","updated_at":"2026-01-30T19:04:20.744310169Z"}
{"id":"code-33","title":"Fix Modal provider image build synchronization","description":"When multiple sandboxes are created concurrently with a cache miss, all of them independently build the image instead of waiting for the first one to finish.\n\nFix by adding synchronization:\n1. Add a build_in_progress mutex to track ongoing builds\n2. First thread to see cache miss acquires the build lock and builds\n3. Other threads wait on the build lock, then recheck the cache\n\nThis prevents redundant Modal API calls when max_parallel \u003e 1.","status":"done","priority":0,"issue_type":"bug","created_at":"2026-01-30T19:10:50.744331585Z","created_by":"Danver Braganza","updated_at":"2026-01-30T19:13:06.208157593Z"}
{"id":"code-34","title":"Investigate Modal image ID caching quirk - image_id may not be final","description":"Modal has a known quirk where the image_id returned from build may not be the 'final' image ID. This causes cached images to still require some rebuild time. Investigate:\n1. How Modal image IDs work (im-* format)\n2. What happens when we call image.build(app) - is the returned ID interim?\n3. Whether there's a way to get the truly final/hydrated image ID\n4. What changes are needed to modal_sandbox.py and the Rust cache to store the correct ID\n\n## Investigation Results\n\n**Root Cause:** Modal images have two phases - lazy (local shell) and hydrated (fully resolved on server). When we get `object_id` after `.build()` without explicit `.hydrate()`, we may get an interim ID that isn't fully resolved on Modal's backend.\n\n**Solution:** Add explicit `.hydrate()` calls:\n1. After `image.build(app)`, call `image.hydrate()` before reading `object_id`\n2. When reconstructing with `Image.from_id(cached_id)`, call `.hydrate()` before use\n\n**Key findings:**\n- `.build(app)` triggers build but may not fully resolve the image\n- `.hydrate()` explicitly forces full hydration on Modal's servers\n- `.from_id()` is lazy - returns local shell until hydrated\n- Only after hydration is `object_id` guaranteed to be the final ID","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-30T19:21:44.277001722Z","created_by":"Danver Braganza","updated_at":"2026-01-30T19:24:43.139331471Z"}
{"id":"code-35","title":"Add .hydrate() calls to Modal image builds for proper caching","description":"Based on investigation in code-34, Modal images need explicit hydration to get the final image ID.\n\n## Changes Required\n\n### In scripts/modal_sandbox.py:\n\n1. **All build functions** (build_dockerfile, build_preset, _build_default, _build_rust, _build_sculptor, etc.):\n   After `image.build(app)`, add `image.hydrate()` before printing `object_id`:\n   ```python\n   image.build(app)\n   image.hydrate()\n   print(image.object_id)\n   ```\n\n2. **create_with_image function**:\n   After `Image.from_id()`, hydrate before using in Sandbox:\n   ```python\n   image = modal.Image.from_id(image_id)\n   image.hydrate()\n   sandbox = modal.Sandbox.create(app=app, image=image, ...)\n   ```\n\n## IMPORTANT: Style Constraints\n- **NO trailing comments** - the ratchet budget for `no-trailing-comments [scripts]` is 3\n- Do NOT add comments on the same line as code\n- If explanation is needed, add a comment on a SEPARATE LINE above the code\n- Prefer no comments at all - `.hydrate()` is self-explanatory\n\n## Why This Fixes the Issue\n- `.build()` triggers the build but may return before full registration\n- `.hydrate()` ensures the image is completely resolved on Modal's backend\n- `.from_id()` is lazy - without hydration, it needs server resolution at use time\n- With proper hydration, cached IDs will be truly 'final' and reuse will be instant","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-30T19:24:53.285151628Z","created_by":"Danver Braganza","updated_at":"2026-01-30T19:34:10.803156011Z"}
{"id":"code-36","title":"Fix Modal image hydration - cannot hydrate on demand","description":"The .hydrate() call fails with:\n```\nraise ExecutionError(\n    \"Images cannot currently be hydrated on demand; you can build an Image by running an App that uses it.\"\n)\n```\n\n## Investigation Results\nModal images can only be hydrated by **using** them in an App (e.g., Sandbox.create()).\n`.hydrate()` cannot be called on images directly.\n\n## Solution Options\n1. **Remove .hydrate() calls** - Accept slight overhead on reuse\n2. **Create dummy sandbox** - Force hydration by briefly creating a sandbox:\n   ```python\n   image.build(app)\n   temp_sandbox = modal.Sandbox.create(app=app, image=image, timeout=10)\n   temp_sandbox.terminate()\n   print(image.object_id)  # Now fully hydrated\n   ```\n\n## Chosen Approach\nPer user suggestion, try Option 2: Create a minimal dummy sandbox to force hydration, then immediately terminate it. This ensures the cached image ID is truly final.\n\n## Changes Required\nReplace `.hydrate()` calls with dummy sandbox creation pattern in all build_* functions in scripts/modal_sandbox.py","status":"done","priority":0,"issue_type":"bug","created_at":"2026-01-30T19:43:48.385925376Z","created_by":"Danver Braganza","updated_at":"2026-01-30T19:49:10.606268095Z"}
{"id":"code-37","title":"Investigate 30-second delay between cache hit and image loading","description":"## Problem\nThere's a ~30 second pause between cache lookup and actual image loading:\n```\n19:54:14 INFO Using cached Modal image for dockerfile:.devcontainer/Dockerfile: im-YlDkL514ar5gcMsBUhUBTd\n19:54:46 INFO Loading image im-YlDkL514ar5gcMsBUhUBTd...  \u003c-- 32 seconds later!\n```\n\n## Investigation Results\n\n### Code Flow\n1. Rust: `get_or_build_image()` finds cached entry, logs 'Using cached Modal image', returns image_id immediately\n2. Rust: `call_python_create_with_image()` spawns Python process\n3. Python: `modal.App.lookup(app_name, create_if_missing=True)` - possibly slow?\n4. Python: `modal.Image.from_id(image_id)` - THIS IS THE DELAY\n5. Python: `modal.Sandbox.create()`\n\n### Root Cause\nThe delay is in the Python script between receiving the image_id and creating the sandbox. Likely causes:\n1. `modal.App.lookup()` may be doing network calls\n2. `modal.Image.from_id()` needs to resolve/hydrate the image from Modal's servers\n3. Python process startup overhead (uv, imports)\n\n### Possible Solutions\n1. **Add more logging** to pinpoint exactly which call is slow\n2. **Pre-create the App** during image build, not sandbox creation\n3. **Accept the latency** if it's inherent to Modal's API design\n4. **Reuse Python process** instead of spawning new one each time (complex)\n\n## Next Step\nAdd detailed timing logs to modal_sandbox.py to identify which specific call takes 30 seconds.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-30T19:56:31.402158173Z","created_by":"Danver Braganza","updated_at":"2026-01-30T19:57:34.504839467Z"}
{"id":"code-38","title":"Add timing logs to create-with-image to identify 30s delay source","description":"Add detailed timing logs to `create_with_image()` in `scripts/modal_sandbox.py` to identify which call is slow:\n\n```python\nimport time\n\n@cli.command('create-with-image')\ndef create_with_image(image_id: str, sandbox_type: str):\n    t0 = time.time()\n    \n    app_name = app_name_map.get(sandbox_type, 'offload-sandbox')\n    print(f'[{time.time()-t0:.2f}s] Looking up app {app_name}...', file=sys.stderr)\n    app = modal.App.lookup(app_name, create_if_missing=True)\n    print(f'[{time.time()-t0:.2f}s] App lookup complete', file=sys.stderr)\n    \n    print(f'[{time.time()-t0:.2f}s] Loading image {image_id}...', file=sys.stderr)\n    image = modal.Image.from_id(image_id)\n    print(f'[{time.time()-t0:.2f}s] Image loaded', file=sys.stderr)\n    \n    print(f'[{time.time()-t0:.2f}s] Creating sandbox...', file=sys.stderr)\n    sandbox = modal.Sandbox.create(app=app, image=image, ...)\n    print(f'[{time.time()-t0:.2f}s] Sandbox created', file=sys.stderr)\n```\n\nThis will show exactly which call takes the 30 seconds.","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-30T19:57:46.085628347Z","created_by":"Danver Braganza","updated_at":"2026-01-30T20:00:20.435313335Z"}
{"id":"code-39","title":"Bump scripts ratchet budgets for false positives (no-global-keyword, no-trailing-comments, no-if-elif-without-else)","description":"The ratchet tool is detecting false positives in scripts/modal_sandbox.py:\n- no-global-keyword: Detects 'global' in git config --global strings (6 violations)\n- no-trailing-comments: Detects inline comments in dependency lists (6 violations)\n- no-if-elif-without-else: Detects 3 violations\n\nSince these are either false positives or acceptable patterns in scripts, bump the budgets to match current violations.","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-30T22:36:19.167496889Z","created_by":"Danver Braganza","updated_at":"2026-01-30T22:39:23.394206918Z"}
{"id":"code-4","title":"Rename executor/mod.rs to executor.rs (2018+ module style)","description":"Rename src/executor/mod.rs to src/executor.rs following STYLE_GUIDE.md. The executor directory contains retry.rs, runner.rs, scheduler.rs which should remain in src/executor/. Update lib.rs module declaration accordingly.","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-27T00:03:35.156671629Z","created_by":"Danver Braganza","updated_at":"2026-01-27T00:15:04.701572295Z"}
{"id":"code-40","title":"Bump src/config ratchet budgets for test code (no-expect, no-panic)","description":"The src/config/schema.rs file has expect() and panic!() calls in test code:\n- no-expect: 2 violations in test functions (expect in toml parsing for tests)\n- no-panic: 4 violations in test functions (panic for expected test conditions)\n\nThese are in #[cfg(test)] blocks and acceptable for tests. Bump the budgets for src/config directory.","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-30T22:36:27.716351462Z","created_by":"Danver Braganza","updated_at":"2026-01-30T22:41:18.886116638Z"}
{"id":"code-41","title":"Bump no-unwrap budget for src directory","description":"The src directory has 29 unwrap() violations but only 15 budget. Many of these are:\n- In test code (cache.rs tests, bundled.rs tests)\n- In Mutex lock patterns (report.rs, framework.rs) where lock poisoning is acceptable\n- In Regex::new with static patterns that cannot fail\n\nBump the src budget from 15 to 29 to match current violations. Future work can refactor these.","status":"done","priority":0,"issue_type":"task","created_at":"2026-01-30T22:36:37.31671205Z","created_by":"Danver Braganza","updated_at":"2026-01-30T22:43:17.998854763Z"}
{"id":"code-42","title":"Tighten ratchet budgets that exceed current violations","description":"After fixing exceeded budgets, run 'ratchet tighten' to reduce budgets that have more allowance than actual violations. This ensures the ratchet only allows the current number of violations, not more.","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-30T22:36:42.963692261Z","created_by":"Danver Braganza","updated_at":"2026-01-30T22:45:53.866118918Z"}
{"id":"code-43","title":"Remove unwrap() calls from src/main.rs","description":"Remove 1 unwrap() call at line 201:\n- config.groups.values().next().unwrap()\n\nReplace with proper error handling using Result or Option combinators.","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-30T23:05:13.40495251Z","created_by":"Danver Braganza","updated_at":"2026-01-30T23:08:27.497480753Z"}
{"id":"code-44","title":"Remove unwrap() calls from src/report.rs","description":"Remove 4 unwrap() calls related to Mutex locks at lines 232, 236, 246, 263.\n\nThese are Mutex::lock().unwrap() patterns. Replace with:\n- .lock().expect() with descriptive message about lock poisoning, OR\n- Custom error handling that propagates the error\n\nNote: Mutex poisoning is rare but the style guide forbids unwrap().","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-30T23:05:19.843762222Z","created_by":"Danver Braganza","updated_at":"2026-01-30T23:14:20.574317583Z"}
{"id":"code-45","title":"Remove unwrap() calls from src/cache.rs tests","description":"Remove 12 unwrap() calls from test functions in cache.rs.\n\nTest functions at approximate lines: 217, 225, 239, 245, 333, 337, 338, 342, 348, 384, 391, 393, 397.\n\nReplace with:\n- Use ? operator with test functions returning Result\n- Or use .expect() with descriptive messages for test assertions","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-30T23:05:26.502349169Z","created_by":"Danver Braganza","updated_at":"2026-01-30T23:05:26.502349169Z"}
{"id":"code-46","title":"Remove unwrap() calls from src/bundled.rs tests","description":"Remove 4 unwrap() calls from test functions in bundled.rs at lines 216, 223, 233, 258.\n\nReplace with ? operator or .expect() with descriptive messages.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-30T23:05:33.303308631Z","created_by":"Danver Braganza","updated_at":"2026-01-30T23:05:33.303308631Z"}
{"id":"code-47","title":"Remove unwrap() calls from src/provider/local.rs","description":"Remove 2 unwrap() calls at lines 217-218:\n- child.stdout.take().unwrap()\n- child.stderr.take().unwrap()\n\nThese are Option unwraps on stdout/stderr handles. Replace with proper error handling.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-30T23:05:39.909295425Z","created_by":"Danver Braganza","updated_at":"2026-01-30T23:05:39.909295425Z"}
{"id":"code-48","title":"Remove unwrap() calls from src/framework/*.rs (Regex patterns)","description":"Remove unwrap() calls on Regex::new() in framework modules:\n\nsrc/framework/default.rs lines 235-236 (2 calls)\nsrc/framework/pytest.rs lines 205, 207-209, 219, 258 (6 calls)  \nsrc/framework/cargo.rs lines 262, 290, 320 (3 calls)\n\nThese are static regex patterns that cannot fail at runtime. Options:\n1. Use lazy_static! or once_cell to compile regexes once\n2. Use .expect() with message explaining the pattern is valid\n3. Return Result from functions and propagate errors","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-30T23:05:47.135373804Z","created_by":"Danver Braganza","updated_at":"2026-01-30T23:05:47.135373804Z"}
{"id":"code-49","title":"Remove unwrap() calls from src/framework.rs (Mutex locks)","description":"Remove 6 unwrap() calls on Mutex locks in framework.rs at lines 226, 231, 236, 248, 255, 260, 274.\n\nThese are self.results.lock().unwrap() patterns. Replace with proper error handling or .expect() with descriptive lock poisoning message.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-30T23:05:52.747572667Z","created_by":"Danver Braganza","updated_at":"2026-01-30T23:05:52.747572667Z"}
{"id":"code-5","title":"Rename provider/mod.rs to provider.rs (2018+ module style)","description":"Rename src/provider/mod.rs to src/provider.rs following STYLE_GUIDE.md. The provider directory contains docker.rs, process.rs, remote.rs, ssh.rs which should remain in src/provider/. Update lib.rs module declaration accordingly.","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-27T00:03:35.716959671Z","created_by":"Danver Braganza","updated_at":"2026-01-27T00:17:13.043386841Z"}
{"id":"code-50","title":"Remove expect() calls from src/config/schema.rs tests","description":"Remove 2 expect() calls in test functions at lines 613 and 648:\n- toml::from_str(toml).expect(\"Failed to parse config\")\n\nReplace with ? operator and have test functions return Result, or use more descriptive expect messages that include the actual error.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-30T23:06:02.77825738Z","created_by":"Danver Braganza","updated_at":"2026-01-30T23:06:02.77825738Z"}
{"id":"code-51","title":"Remove panic!() calls from src/config/schema.rs tests","description":"Remove 4 panic!() calls in test functions at lines 625, 628, 660, 663.\n\nThese are in match arms for expected test conditions. Replace with:\n- assert! or assert_eq! macros for clearer test assertions\n- Or restructure tests to avoid explicit panics","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-30T23:06:08.893736592Z","created_by":"Danver Braganza","updated_at":"2026-01-30T23:06:08.893736592Z"}
{"id":"code-6","title":"Rename report/mod.rs to report.rs (2018+ module style)","description":"Rename src/report/mod.rs to src/report.rs following STYLE_GUIDE.md. The report directory contains junit.rs which should remain in src/report/. Update lib.rs module declaration accordingly.","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-27T00:03:36.326795046Z","created_by":"Danver Braganza","updated_at":"2026-01-27T00:19:18.464449969Z"}
{"id":"code-7","title":"Resolve duplicate thiserror dependency versions","description":"The codebase has duplicate versions of thiserror (v1.0.69 and v2.0.18).\n\nDetails:\n- offload directly depends on thiserror v1.0.69\n- bollard (docker client) transitively pulls in thiserror v2.0.18\n- This creates unnecessary binary bloat\n\nResolution options:\n1. Update bollard dependency to a version that uses thiserror v1.x (if available)\n2. Update offload to use thiserror v2.x to match bollard\n3. Document as acceptable if no easy resolution exists\n\nImpact: Low priority - builds work fine, but increases binary size slightly.","status":"done","priority":2,"issue_type":"task","created_at":"2026-01-27T00:20:50.872026178Z","created_by":"Danver Braganza","updated_at":"2026-01-27T00:26:51.431231803Z"}
{"id":"code-8","title":"Rename executor module to orchestrator","description":"Comprehensively rename the 'executor' module to 'orchestrator' since Orchestrator is its key component.\n\nFiles to rename:\n- src/executor.rs → src/orchestrator.rs\n- src/executor/ directory → src/orchestrator/ directory\n- src/executor/runner.rs → src/orchestrator/runner.rs\n- src/executor/retry.rs → src/orchestrator/retry.rs\n- src/executor/scheduler.rs → src/orchestrator/scheduler.rs\n\nReferences to update:\n- lib.rs: pub mod executor → pub mod orchestrator, re-exports\n- main.rs: use offload::executor::Orchestrator\n- report.rs: use crate::executor::RunResult\n- report/junit.rs: use crate::executor::RunResult\n- Documentation strings in executor.rs, lib.rs, runner.rs, retry.rs, scheduler.rs\n\nDoc comments referencing offload::executor::* must be updated to offload::orchestrator::*","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-28T18:57:46.210148216Z","created_by":"Danver Braganza","updated_at":"2026-01-28T19:05:06.97055317Z"}
{"id":"code-9","title":"Rename project: Update Cargo.toml from offload to offload","description":"Update Cargo.toml to rename the package, binary, and library from 'offload' to 'offload'. This is part of the project rename from offload/trawl to offload.","status":"done","priority":1,"issue_type":"task","created_at":"2026-01-29T18:24:47.950373384Z","created_by":"Danver Braganza","updated_at":"2026-01-29T18:28:38.897329Z"}
